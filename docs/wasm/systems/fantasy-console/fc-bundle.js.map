{"version":3,"file":"fc-bundle.js","sources":["common/scale-element.ts","fc-main.ts"],"sourcesContent":["export const scaleElement = (conWidth: number, conHeight: number, canvas: HTMLElement) => {\n\t// Go back to full size\n\tcanvas.style.transform = `translate(0px, 0px) scale(1)`;\n\n\tconst minDimension = Math.min(conWidth, conHeight);\n\n\tconst newScale = minDimension / canvas.offsetWidth;\n\tconst newHeight = canvas.offsetHeight * newScale;\n\tconst newWidth = canvas.offsetWidth * newScale;\n\n\tconst offsetWidth = (canvas.offsetWidth - newWidth) / 2;\n    const offsetHeight = (canvas.offsetHeight - newHeight) / 2;\n\n\tcanvas.style.transform = `translate(${-offsetWidth}px, ${-offsetHeight}px) scale(${newScale})`;\n}\n","declare const FS: any;\ndeclare const Module: any;\n\nimport { scaleElement } from \"./common/scale-element\";\n\n// Don't use the resize event -- sometimes the canvas and iframe\n// is hidden and therefore has a size of 0.  The ResizeObserver\n// doesn't have universal support.\nconst r = () => {\n\tconst canvas = document.querySelector(\"canvas\") as HTMLCanvasElement;\n\tconst { width, height } = (window.parent as any).GET_IFRAME_SIZE();\n\tscaleElement(width, height, canvas);\n\tsetTimeout(r, 500);\n};\nr();\n\n\n// CLOCK SPEED IN CYCLES PER SECOND\nconst CPS = 1000000;\nlet currentCps = CPS;\n\n\nconst CPU_SPEEDS = (() => {\n\tconst _1MHz = 1000000;\n\tconst percents = [0.1, 1, 10, 25, 50, 100, 147];\n\treturn percents.map(percent => {\n\t\tconst speed = _1MHz * (percent / 100);\n\t\tconst words = (speed / _1MHz).toFixed(3) + \" Mhz\";\n\t\treturn {\n\t\t\tspeed,\n\t\t\twords,\n\t\t}\n\t});\n})();\n\nwindow.addEventListener('message', (e: MessageEvent) => {\n\tconst m = JSON.parse(e.data) as SendRomMessage;\n\tconst boot_machine = Module.cwrap('boot_machine', null, ['void']);\n\n\tif (m.action === \"send-rom\") {\n\t\tconst bin = Uint8Array.from(JSON.parse(m.json));\n\t\tFS.writeFile(\"/file.rom\", bin);\n\t\tboot_machine();\n\t\tconsole.log(`Glory! Received new ROM of ${bin.length}`);\n\t}\n}, false);\n\nwindow.addEventListener(\"keydown\", (e: KeyboardEvent) => {\n\tconst write6502 = Module.cwrap('write6502', 'void', ['number', 'number']);\n\tconst ascii = e.key.charCodeAt(0)\n\tconsole.log(ascii, e.key, e.keyCode);\n\twrite6502(0xFF, ascii);\n});"],"names":[],"mappings":"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"}